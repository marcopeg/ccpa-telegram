# Custom `/start` message

Support configuration for a custom `/start` message. The `/start` command is currently hardcoded (inherited from the forked project) and must become dynamic per project.

## Where `/start` lives today

- **Handler**: `src/bot/commands/start.ts` — `startHandler(ctx)` with a fixed welcome string; it only receives Grammy `Context`, not `ProjectContext`.
- **Wiring**: `src/bot.ts` — `bot.command("start", startHandler)`.
- **Commands list**: `src/bot/commands/loader.ts` — `BUILTIN_COMMANDS` includes `{ command: "start", description: "Welcome message", filePath: "" }`.

To make `/start` dynamic:

1. Add a `start` section to the **per-project** config schema and to `ResolvedProjectConfig`; resolve it in `resolveProjectConfig` (in `src/config.ts`).
2. Change the handler to a factory that receives `ProjectContext`, e.g. `createStartHandler(projectCtx)`, and wire it in `bot.ts` as `bot.command("start", createStartHandler(projectCtx))` (same pattern as `createClearHandler` / `createSessionHandler`).
3. When a project has `start` config, use it; when it does not, keep the current default welcome message behavior.

## Configuration shape

`start` is **per-project** (under each entry in `projects[]`):

```json
{
  "projects": [
    {
      "name": "myproject",
      "cwd": "./myproject",
      "telegram": { "botToken": "..." },
      "start": {
        "session": {
          "reset": true
        },
        "message": {
          "text": "Welcome!"
        }
      }
    }
  ]
}
```

Or with a file-sourced message:

```json
"start": {
  "session": { "reset": false },
  "message": {
    "from": "./welcome.md"
  }
}
```

### `start.session.reset` (optional, boolean, default `false`)

If `true`, when the user sends `/start`, the bot resets the session before sending the welcome message. This is the same effect as `/new` or `/clear`: clear local session data and, for engines that support active reset (copilot, codex), send the `sessionMsg` without `continueSession` to force a new session. If `false` or omitted, only the welcome message is sent.

### `start.message` (required when `start` is present)

Exactly **one** of `text` or `from` must be set:

- **`text`** (string): Inline welcome message content.
- **`from`** (string): Path to a file, **relative to the project `cwd`**. The file content (UTF-8) is read and used as the welcome message.

**Validation (boot-time errors):**
- Both `text` and `from` set → config error, bot refuses to start.
- Neither `text` nor `from` set → config error, bot refuses to start.
- `from` points to a file that does not exist or cannot be read → config error, bot refuses to start.

### Telegram formatting

The welcome message is sent with `parse_mode: "Markdown"` (legacy Markdown, consistent with the rest of the codebase). Supported formatting:

- `*bold*`
- `_italic_`
- `` `inline code` ``
- ` ```code blocks``` `
- `[link text](https://url)`

## Variable substitution

Both the inline `message.text` and the content of the file referenced by `message.from` must support the **same placeholder/variable substitution** as the rest of the system (see `src/context/resolver.ts`):

- **`${varName}`** — app/env and implicit context: `bot.userId`, `bot.firstName`, `bot.username`, `sys.date`, `sys.datetime`, `project.name`, `project.cwd`, `project.slug`, etc.
- **`@{}`** — message-time shell execution.
- **`#{}`** — boot-time shell (if applicable when resolving the start message).

When sending the `/start` reply, build the same context (via the existing resolver or a shared helper) and run substitution on the message string before sending.

## Expected behavior

1. **No `start` config**: Current hardcoded welcome message, no session reset.
2. **With `start` config**:
   - If `start.session.reset === true`: reset the session (same as `/new`/`/clear`), then send the welcome message.
   - Welcome message is either `start.message.text` or the content of the file at `start.message.from` (resolved relative to project `cwd`), after variable substitution.
   - Message sent with `parse_mode: "Markdown"`.
3. **Config errors** (bot refuses to start):
   - Both `text` and `from` set.
   - Neither `text` nor `from` set.
   - `from` file does not exist or is unreadable.
