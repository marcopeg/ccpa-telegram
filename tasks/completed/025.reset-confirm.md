# 025 — Confirm /reset before deleting user data

Status: draft

## Context
The current `/reset` command deletes the user's data folder without an explicit Telegram-side confirmation step.

Because this action is destructive, the bot should ask for confirmation before proceeding.

The project currently has no callback query handling infrastructure — this task introduces it for the first time.

## Scope
- Update `/reset` flow to send a confirmation message before deleting user data.
- Use Grammy's built-in `InlineKeyboard` (no external plugin) with two buttons:
  - `Yes, go ahead!`
  - `Abort!`
- Register a `bot.on("callback_query:data", ...)` handler to process button taps.
- Execute deletion only after the user taps `Yes, go ahead!`.
- Cancel the operation with no deletion when the user taps `Abort!`.
- Keep the warning text explicit: `This is going to delete the user data folder. Are you sure?`
- After successful deletion, reply with a separate hardcoded confirmation message (not the configurable `commands.reset.message`). The configurable message will be revisited later.

### Prompt timeout
- Add a `commands.reset.timeout` config option (default: `60` seconds).
- When the timeout elapses without user interaction, auto-remove the inline keyboard buttons from the prompt message (edit the message to strip the reply markup).

### Repeated invocations
- If a user sends `/reset` while a previous confirmation prompt is still active, invalidate the earlier prompt (edit it to remove buttons / mark it as expired) before sending the new one.

## Acceptance Criteria
- Invoking `/reset` never deletes data immediately.
- The bot sends a confirmation prompt with the required warning text.
- The prompt includes both required actions (`Yes, go ahead!` and `Abort!`).
- User data is deleted only after explicit confirmation.
- Choosing `Abort!` leaves user data unchanged and edits the prompt to acknowledge cancellation.
- An unanswered prompt auto-expires after `commands.reset.timeout` seconds (default 60), removing the buttons.
- Sending `/reset` again while a prompt is active invalidates the previous prompt.
- Callback data is scoped per user so prompts from different users don't interfere.

## Technical Notes
- Inline keyboard buttons use `callback_data` — Telegram's limit is 64 bytes per button. Use a compact scheme (e.g. `reset:confirm:<userId>` / `reset:abort:<userId>`).
- Telegram does not support a red/danger button style for inline keyboards. Keep the destructive action clearly labeled and preserve the warning-first UX.
- The callback query handler should call `answerCallbackQuery()` to dismiss the loading indicator on the client side.
