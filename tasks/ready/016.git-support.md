# Git support (global commands)

Add global `/commands` for managing git inside a project. All commands run in the project directory (`config.cwd`). Implementation lives in the codebase and is shipped with the package; commands are registered with Telegram via `setMyCommands` only when the feature is enabled for that bot.

## Config

Git support is optional and gated by a config flag. The flag can live in **globals** and/or **per-project** (project overrides globals, same pattern as other optional features).

```json
{
  "git": {
    "enabled": true
  }
}
```

- Add `git?: { enabled?: boolean }` to config schema (globals and project).
- Resolve to a boolean in `ResolvedProjectConfig` (e.g. `gitEnabled`).
- When `gitEnabled` is true: wire git command handlers in `bot.ts`, include git commands in the merged list passed to `loadCommands` / `setMyCommands` (loader must receive a way to know git is enabled so it can add git entries).

## Commands

### `/git_init`

- If the project directory is already a git repo, do nothing (or report "already a repo").
- If not, run `git init` and perform an initial commit (e.g. "Initial commit" or configurable message).

### `/git_status`

- Run `git status` in the project directory and send the output to the user (e.g. as a message or formatted reply).

### `/git_commit [message]`

- Run `git add` (stage all changes) then `git commit`.
- **If the user provides a message** (e.g. `/git_commit fix bug`): use that as the commit message.
- **If no message is passed**: use the AI engine (same as for chat) to generate a commit message from the current changes (e.g. run `git diff` / `git status`, send that to the engine with a prompt like "Generate a short commit message for these changes"), then commit with the generated message.

### `/git_clean [file_name]`

- Revert **uncommitted** changes only (working tree; e.g. `git restore <file>`). Do not undo commits.
- **When a single file is passed and can be parsed**: revert that file and confirm to the user (no extra UI flow required, unless you want a simple confirm for consistency).
- **When no file is passed or the argument cannot be easily parsed**: use Telegram UI to let the user choose what to revert:
  1. **File list**: Send a message listing **files with uncommitted changes** (e.g. from `git status --short` or equivalent). Present them so the user can select which file(s) to revert. Include an option **"Reset all"** (revert all such files).
  2. **Selection**: User selects one or more files (or "Reset all") via Telegram UI (e.g. inline keyboard with callback buttons).
  3. **Confirm step**: After selection, send a second message that:
     - Lists the file(s) that will be reset.
     - Asks: "Confirm reset these files and lose the changes?"
     - Provides **Confirm** and **Cancel** buttons in the Telegram UI (inline keyboard). On Confirm, run `git restore` for the chosen file(s). On Cancel, abort and optionally notify the user.

Implementation note: use Telegram **inline keyboards** (`InlineKeyboardButton` with `callback_data`) and a **callback_query** handler to process the userâ€™s choices and the final confirm/cancel. This is the standard pattern for confirm flows in the Bot API.

## Summary

- **Built-in style**: Git commands are implemented as handlers in `src/bot/commands/` (like start, help, reset, clean), not as `.mjs` or skills.
- **Registration**: When `config.git.enabled` is true, register the four commands with the bot and include them in the command list sent to `setMyCommands` (loader needs to accept git-enabled flag or config so the list is correct).
- **Scope**: All git operations run in `config.cwd`. No project-specific overrides beyond the `git.enabled` flag.
