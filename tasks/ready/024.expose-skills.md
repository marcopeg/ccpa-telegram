# 024 — Expose skills across engines

Status: draft

## Context

HAL currently hardcodes `.claude/skills` as the skill directory for all engines (except Cursor, which uses `.cursor/rules`). This is incorrect — each engine has its own conventions for where skills live, and most now support the open [Agent Skills standard](https://agentskills.io/) via `.agents/skills/`.

The `EngineAdapter` interface already has a `skillsDir()` method returning a single string. This needs to evolve into an ordered list of skill source directories per engine, reflecting each engine's native discovery behavior.

## Research: Engine Skill Conventions

Sources: official docs, agentskills.io spec, VS Code Copilot docs (Feb 2026).

### Claude Code
- **Primary**: `.claude/skills/{name}/SKILL.md`
- **Legacy**: `.claude/commands/` (merged into skills, still supported)
- **Does NOT support** `.agents/skills/` as of Feb 2026
- Nested discovery: also looks in subdirectory `.claude/skills/` relative to edited files
- Conflict resolution: enterprise > personal > project; skills shadow same-name commands
- Source: https://code.claude.com/docs/en/skills

### Codex (OpenAI)
- **Primary**: `.agents/skills/{name}/SKILL.md`
- Walks parent directories up to git root
- User-level: `~/.agents/skills/` (also `~/.codex/skills/`)
- System-level: `/etc/codex/skills`
- Source: https://developers.openai.com/codex/skills

### GitHub Copilot (CLI + VS Code + coding agent)
- **Project**: `.github/skills/`, `.claude/skills/`, `.agents/skills/`
- **Personal**: `~/.copilot/skills/`, `~/.claude/skills/`, `~/.agents/skills/`
- All three project paths appear to be equal peers (configurable via `chat.agentSkillsLocations`)
- Conflict resolution across paths: not explicitly documented; for `AGENTS.md`, nearest file takes precedence
- Source: https://code.visualstudio.com/docs/copilot/customization/agent-skills, https://docs.github.com/copilot/concepts/agents/about-agent-skills

### OpenCode
- **Project**: `.opencode/skills/`, `.claude/skills/`, `.agents/skills/`
- **Global**: `~/.config/opencode/skills/`, `~/.claude/skills/`, `~/.agents/skills/`
- Walks upward from CWD to git worktree root
- Custom paths configurable via `opencode.json` `skills.path`
- Source: https://open-code.ai/en/docs/skills

### Cursor
- **Primary**: `.agents/skills/`, `.cursor/skills/`
- **User-level**: `~/.cursor/skills/`
- **Compat**: `.claude/skills/`, `.codex/skills/` (lower priority)
- Source: https://cursor.com/docs/context/skills

## Proposed Skill Source Mapping

Each engine adapter returns an **ordered list** of project-level skill directories (highest priority first). HAL scans all directories and deduplicates by skill name — first-found wins.

| Engine    | Skill directories (in priority order)                     |
|-----------|-----------------------------------------------------------|
| Claude    | `.claude/skills`                                          |
| Codex     | `.agents/skills`                                          |
| Copilot   | `.agents/skills`, `.github/skills`, `.claude/skills`      |
| OpenCode  | `.agents/skills`, `.opencode/skills`, `.claude/skills`    |
| Cursor    | `.agents/skills`, `.cursor/skills`                        |

Notes on the mapping:
- `.agents/skills` is listed first (highest priority) for every engine that supports it, per the project's preference for the open standard.
- Claude does not support `.agents/skills` natively, so only `.claude/skills` is listed. If/when Claude adds `.agents/skills` support, it should be added at highest priority.
- Copilot lists `.github/skills` before `.claude/skills` because `.github/` is the native Copilot convention; `.claude/skills` is a compat path.
- We only list project-level paths. Personal/global paths (`~/...`) are not relevant since HAL operates on a specific project directory.

## Goal

Change the engine adapter interface and skill loading pipeline so that:
- each engine declares an ordered list of skill source directories,
- the loader scans all directories and deduplicates by skill name (first-found wins),
- the watcher monitors all declared directories for changes,
- skills are surfaced in `/help` and pushed to Telegram Bot API as today.

## Scope

- Change `skillsDir(projectCwd: string): string` to `skillsDirs(projectCwd: string): string[]` on `EngineAdapter`.
- Update each engine adapter to return the correct ordered list per the mapping above.
- Update `scanSkillsDir` (or introduce a new multi-dir scanner) to iterate over all directories, dedup by skill name, first-found wins.
- Update `resolveSkillEntry` to search across all skill directories in order.
- Update the watcher to monitor all skill directories.
- Update `getSkillsDir` fallback in `src/agent/index.ts`.
- Update all call sites that use the single `skillsDir()` method.
- Document the engine-to-skill-sources mapping in `README.md`.

## Acceptance Criteria

- `EngineAdapter.skillsDirs()` returns an ordered `string[]` for each engine.
- The mapping matches the table in this document.
- Skills are loaded from all declared directories; when the same skill name exists in multiple directories, the one from the highest-priority directory wins.
- `/help` output includes discovered skills from all sources.
- Telegram command registration includes skills from all sources.
- The watcher detects changes in any of the declared skill directories.
- Engine-to-skill-sources mapping is documented in `README.md`.
- Existing behavior is preserved for projects that only use one skill directory.

## Notes

- The Agent Skills open standard spec: https://agentskills.io/specification
- No backward compatibility layer needed — just change the paths.
- See plan: [024.expose-skills.plan.md](./024.expose-skills.plan.md).
