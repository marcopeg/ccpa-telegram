# 026 â€” Add Google Antigravity Engine

Status: draft

## Context
HAL engine integrations (Codex, OpenCode, Cursor) are implemented as subprocess-based adapters with a stable command-line interface and non-interactive execution.

The goal is to add support for Google Antigravity using the same architecture and UX expectations.

## Research Summary (external)
Based on current public pages:
- Antigravity is presented as an agent-first IDE/platform with Editor + Agent Manager surfaces.
- Public docs clearly document product UX, local installation, settings, skills, MCP, and sandbox/security modes.
- A clearly documented, stable, headless CLI/API for external orchestration (equivalent to `codex exec`, `opencode run`, `agent --print`) is not explicitly identified in the currently reviewed pages.

Sources reviewed:
- https://antigravity.google/
- https://antigravity.google/docs
- https://antigravity.google/product
- https://antigravity.google/download
- https://developers.googleblog.com/build-with-google-antigravity-our-new-agentic-development-platform/
- https://codelabs.developers.google.com/getting-started-google-antigravity

## Goal
Introduce an `antigravity` engine adapter for HAL, but only on top of a documented, supportable Antigravity automation interface.

## Scope
- Add `antigravity` to engine name validation and registry wiring.
- Implement `src/engine/adapters/antigravity.ts` with the same adapter contract used by existing engines.
- Support config shape parity with existing engines:

```json
"engine": {
  "name": "antigravity",
  "model": "...",
  "session": true,
  "sessionMsg": "hi!"
}
```

- Keep behavior aligned with prior engine tasks:
  - subprocess execution,
  - deterministic output capture,
  - check() command validation,
  - parse() response normalization,
  - `/clean` session reset semantics.

## Discovery Gate (mandatory)
Before coding full adapter behavior, confirm one of these integration paths from official docs:
1. **Headless CLI path**: stable command for non-interactive execution and output capture.
2. **Official API path**: supported remote API that can be wrapped by HAL adapter.

If neither path exists, do not ship a fake adapter.

## Fallback Strategy (if gate fails)
- Keep `antigravity` behind an explicit non-ready status (or defer merge) and document blocker.
- Produce a short implementation note with:
  - confirmed capability gaps,
  - required upstream features,
  - recommended interim option (e.g. use existing supported engines in HAL).

## Acceptance Criteria
- `antigravity` can be selected in config and CLI only if a supported automation path is confirmed.
- Adapter behavior follows existing engine contract (execute/check/parse, cwd scoping, session handling).
- `/clean` forces a new session according to the selected automation path.
- Clear operator-facing docs exist for install/auth/setup and known limitations.
- If no official automation path is available, task outcome is explicitly marked as blocked with evidence and no misleading partial integration is shipped.

## Notes
- Model defaults should stay out of this task unless required for basic functionality (handled by default-model tasks).
- Preserve project isolation semantics (`cwd`) exactly as with other engines.
