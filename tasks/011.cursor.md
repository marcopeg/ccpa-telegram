# Add Cursor Engine

Add support for the Cursor agent CLI as an engine. Scope: **cursor adapter only** (no separate documentation for other engines or OpenRouter/LM Studio).

## Config shape

Same as existing engines:

```json
"engine": {
    "name": "cursor",
    "model": "claude-4-sonnet-thinking",
    "session": true,
    "sessionMsg": "hi!"
}
```

- **name**: `"cursor"`
- **model**: One of the models available in Cursor (e.g. `claude-4-sonnet-thinking`, `gpt-5`, or others from `cursor agent models`). Pick a sensible default for the adapter.
- **session** / **sessionMsg**: Same semantics as Copilot/Codex (continue vs fresh; session renewal uses sessionMsg without continue).

## Invocation

- **Command**: The agent is the `agent` subcommand of the Cursor CLI. Default executable is `cursor`, so the full command is **`cursor agent`** (first argument `agent`). Allow overriding the base command via config (e.g. `engine.command`) so the adapter runs `cursor agent` or an alternative wrapper.
- **Flags** (from [Cursor CLI parameters](https://cursor.com/docs/cli/reference/parameters)):
  - `--workspace <dir>` — project cwd
  - `--model <model>` — model from config
  - `--continue` — resume previous session (alias for `--resume=-1`); use when `engine.session` is true and we want to continue
  - `-p, --print` — non-interactive output (required for script/automation)
  - `--output-format` — optional: `text`, `json`, or `stream-json`; use whatever fits parsing (see other adapters for streaming vs buffered)
- **Prompt**: Pass the resolved prompt as the initial prompt argument to `cursor agent`.

Use `cursor agent --help` (or the official docs) to confirm flag names and any extra flags needed for non-interactive, scripted runs (e.g. `--trust` for headless).

## Implementation requirements

1. **Engine contract**: Implement the same `EngineAdapter` interface as Codex/Copilot: `check()`, `execute()`, `parse()`, `skillsDir()`, `instructionsFile()`.
2. **Session behavior**: Align with Copilot/Codex:
   - Fresh run: no `--continue`, pass `--workspace`.
   - Continue: pass `--continue` (and `--workspace` if required).
   - Session renewal (e.g. `/session`): send `engineSessionMsg` without continue, then treat as new session.
3. **Check**: Verify the CLI is available (e.g. run `cursor agent --version` or `cursor --version` and ensure the `agent` subcommand exists).
4. **Registry**: Add `cursor` to `EngineName`, config schema, engine registry, and CLI `--engine` options. Handle cursor in session/renewal logic where Copilot/Codex are currently special-cased.

## Reference: Cursor IDE help

The main `cursor --help` output describes the IDE; the agent is under the **agent** subcommand:

```text
Subcommands
  ...
  agent        Start the Cursor agent in your terminal.
```

For flags and usage, rely on `cursor agent --help` and the [Cursor CLI parameters](https://cursor.com/docs/cli/reference/parameters) doc.
