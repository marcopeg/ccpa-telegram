# 024 — Expose skills across engines — Plan

## Phase 1: Interface change ✅

Update the `EngineAdapter` interface to return multiple skill directories.

### Step 1.1 — Change `skillsDir` to `skillsDirs` on `EngineAdapter` ✅

**File:** `src/engine/types.ts`

- Renamed `skillsDir(projectCwd: string): string` to `skillsDirs(projectCwd: string): string[]`
- Updated JSDoc to reflect ordered list semantics (highest priority first)

## Phase 2: Engine adapters ✅

Update each adapter to return the correct ordered list per the research mapping.

### Step 2.1 — Claude adapter ✅

**File:** `src/engine/adapters/claude.ts`

- Returns `[join(projectCwd, ".claude", "skills")]` (single entry — Claude does not support `.agents/skills`)

### Step 2.2 — Codex adapter ✅

**File:** `src/engine/adapters/codex.ts`

- Returns `[join(projectCwd, ".agents", "skills")]`
- Removed legacy comment about sharing `.claude/skills`

### Step 2.3 — Copilot adapter ✅

**File:** `src/engine/adapters/copilot.ts`

- Returns `[".agents/skills", ".github/skills", ".claude/skills"]` (priority order)

### Step 2.4 — OpenCode adapter ✅

**File:** `src/engine/adapters/opencode.ts`

- Returns `[".agents/skills", ".opencode/skills", ".claude/skills"]` (priority order)

### Step 2.5 — Cursor adapter ✅

**File:** `src/engine/adapters/cursor.ts`

- Returns `[".agents/skills", ".cursor/skills"]` (priority order)
- Changed from old `.cursor/rules` to correct `.cursor/skills`

## Phase 3: Skill loader ✅

Update the loader to scan multiple directories and deduplicate.

### Step 3.1 — Update `loadCommands` signature ✅

**File:** `src/bot/commands/loader.ts`

- Changed `skillsDir?: string` to `skillsDirs?: string[]`
- Iterates directories in priority order with `seenSkills` Set for dedup (first-found wins)

### Step 3.2 — Update `resolveSkillEntry` signature ✅

**File:** `src/bot/commands/loader.ts`

- Changed `skillsDir: string` to `skillsDirs: string[]`
- Iterates directories in order, returns first match found

## Phase 4: Helper function ✅

### Step 4.1 — Update `getSkillsDir` to `getSkillsDirs` ✅

**File:** `src/agent/index.ts`

- Renamed to `getSkillsDirs`, returns `string[]`
- Delegates to `ctx.engine.skillsDirs(projectCwd)` when engine is available
- Fallback: returns `[join(projectCwd, ".claude", "skills")]`

## Phase 5: Call sites ✅

### Step 5.1 — `src/bot.ts` ✅

- Changed to `engine.skillsDirs(config.cwd)` returning array
- Passes array to both `loadCommands` and `startCommandWatcher`

### Step 5.2 — `src/bot/commands/watcher.ts` ✅

- Changed parameter to `skillsDirs?: string[]`
- Uses spread operator `watchPaths.push(...skillsDirs)` to watch all dirs
- Passes array to `loadCommands` in `republish`
- Updated debug log key

### Step 5.3 — `src/bot/commands/message.ts` ✅

- Changed to `engine.skillsDirs(config.cwd)` and passes array to `loadCommands`

### Step 5.4 — `src/bot/handlers/text.ts` ✅

- Changed import from `getSkillsDir` to `getSkillsDirs`
- Passes array to `resolveSkillEntry`

## Phase 6: Documentation ✅

### Step 6.1 — Update `README.md` ✅

- Added engine-to-skill-sources mapping table in the Skills section
- Updated directory tree example to show `.agents/skills/` as primary
- Updated command precedence to reference engine skills table
- Added note on conflict resolution (highest-priority directory wins)

## Phase 7: Verify ✅

### Step 7.1 — Lint and build ✅

- `pnpm run lint:fix` — no issues found
- `pnpm run build` — TypeScript compilation successful
- Grep confirmed zero remaining references to old `skillsDir` (singular) in `src/`
